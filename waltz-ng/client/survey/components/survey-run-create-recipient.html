<!--
  ~ Waltz - Enterprise Architecture
  ~ Copyright (C) 2016, 2017, 2018, 2019 Waltz open source project
  ~ See README.md for more information
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific
  ~
  -->

<div>
    <h4><strong>Recipients</strong></h4>
    <hr/>

    <div ng-class="{'waltz-scroll-region-400': $ctrl.surveyRunRecipients.length > 15}">
        <table class="table table-condensed table-hover small">
            <thead>
            <tr>
                <th>Entity Name</th>
                <th>Person Name</th>
                <th>Email</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            <tr ng-repeat="recipient in $ctrl.surveyRunRecipients"
                class="waltz-visibility-parent"
                ng-class="{'danger': recipient.isExcluded}">
                <td><span ng-bind="recipient.surveyInstance.surveyEntity.name"></span></td>
                <td><span ng-bind="recipient.person.displayName"></span></td>
                <td><span ng-bind="recipient.person.email"></span></td>
                <td>
                    <button class="btn btn-xs btn-danger waltz-visibility-child-50"
                            ng-if="$ctrl.isRecipientIncluded(recipient)"
                            ng-click="$ctrl.excludeRecipient(recipient)"
                            uib-popover="Exclude"
                            popover-trigger="mouseenter">
                        <waltz-icon name="trash">
                    </button>
                    <button class="btn btn-xs btn-success waltz-visibility-child-50"
                            ng-if="!($ctrl.isRecipientIncluded(recipient))"
                            ng-click="$ctrl.includeRecipient(recipient)"
                            uib-popover="Include"
                            popover-trigger="mouseenter">
                        <waltz-icon name="plus">
                    </button>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <hr/>
    <div class="row">
        <div class="col-sm-offset-2 col-sm-10">
            <a ng-click="$ctrl.goBack()"
               class="clickable">
                Back
            </a>
            <button type="button"
                    ng-if="$ctrl.includedRecipients.length > 0"
                    ng-click="$ctrl.onSubmit()"
                    class="btn btn-success">
                Next
            </button>
            <span ng-if="$ctrl.includedRecipients.length === 0"
                  class="alert alert-warning"
                  style="padding-bottom: 10px;">
                At least 1 recipient required to issue a survey run
            </span>
        </div>
    </div>

</div>
