<!--
  ~ Waltz - Enterprise Architecture
  ~ Copyright (C) 2016, 2017, 2018, 2019 Waltz open source project
  ~ See README.md for more information
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific
  ~
  -->

<div>
    <waltz-section-actions>
        <waltz-data-extract-link name="Export"
                                 extract="app-cost/by-selector"
                                 method="POST"
                                 request-body="$ctrl.selectionOptions"
                                 styling="link">
        </waltz-data-extract-link>
        <button class="btn btn-xs waltz-btn-transparent"
                ng-click="$ctrl.sourceDataOverlay = ! $ctrl.sourceDataOverlay">
            <waltz-icon name="map-signs"></waltz-icon>
        </button>
    </waltz-section-actions>

    <waltz-source-data-overlay visible="$ctrl.sourceDataOverlay"
                               entities="['ASSET_COST']">
    </waltz-source-data-overlay>

    <div ng-if="$ctrl.topCosts.length === 0">
        <waltz-no-data>
            <message>
                <strong>No associated costs found.</strong>
            </message>
        </waltz-no-data>
    </div>

    <div class="row">
        <div class="col-sm-12">
            <uib-tabset ng-if="$ctrl.topCosts.length > 0">
                <!-- TOP 10 -->
                <uib-tab select="$ctrl.showSummary()">
                    <uib-tab-heading>
                        Top 10
                    </uib-tab-heading>

                    <br >

                    <div class="row">
                        <div class="col-sm-9">
                            <div ng-if="$ctrl.visibility.summary">
                                <waltz-asset-costs-graph costs="$ctrl.topCosts"
                                                         style="width: 95%"
                                                         on-select="$ctrl.onSummarySelect">
                                </waltz-asset-costs-graph>
                            </div>
                        </div>

                        <div class="col-sm-3"
                             style="border-left: 1px solid #eee">

                            <!-- STATIC PANEL -->
                            <div ng-if="! $ctrl.summarySelection"
                                 class="waltz-fade-if">
                                <waltz-static-panels group-key='SECTION.ASSET_COSTS.ABOUT'
                                                     class="small"
                                                     render-mode="minimal-border">
                                </waltz-static-panels>
                            </div>

                            <!-- SUMMARY SECTION -->
                            <div ng-if="$ctrl.summarySelection"
                                 class="waltz-fade-if">
                                    <h5>
                                        <waltz-entity-link entity-ref="$ctrl.summarySelection.entityRef"
                                                           tooltip-placement="left-top">
                                        </waltz-entity-link>
                                        <a class="clickable"
                                           title="Dismiss"
                                           ng-click="$ctrl.summarySelection = null">
                                            <span class="pull-right">x</span>
                                        </a>
                                    </h5>
                                <hr>

                                <table class="table table-condensed table-striped small">
                                    <thead>
                                    <tr>
                                        <th>Type</th>
                                        <th>
                                            <div align="right">
                                                Amount
                                            </div>
                                        </th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr ng-repeat="row in $ctrl.summarySelection.costTable | orderBy:'type'">
                                        <td>
                                            <span ng-bind="row.type"></span>
                                        </td>
                                        <td align="right">
                                            <waltz-currency-amount amount="row.amount">
                                            </waltz-currency-amount>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <strong>Total</strong>
                                        </td>
                                        <td align="right">
                                            <waltz-currency-amount amount="$ctrl.summarySelection.total">
                                            </waltz-currency-amount>
                                        </td>
                                    </tr>
                                    </tbody>

                                </table>
                            </div>

                        </div>
                    </div>
                </uib-tab>

                <!-- ALL -->
                <uib-tab select="$ctrl.showDetail()">
                    <uib-tab-heading>
                        All Data
                    </uib-tab-heading>

                    <br>

                    <div ng-if="$ctrl.visibility.detail">
                        <div ng-if="$ctrl.allCosts.length > 0">
                            <waltz-asset-cost-table options='{
                                                        showAppName: true,
                                                        showAssetCode: false
                                                    }'
                                                    csv-name='{{ $ctrl.csvName }}'
                                                    costs='$ctrl.allCosts'>
                            </waltz-asset-cost-table>
                        </div>
                    </div>
                </uib-tab>
            </uib-tabset>
        </div>
    </div>

</div>
